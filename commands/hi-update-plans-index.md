# 更新 Plans 索引

掃描索引檔和專案設計文件，自動歸檔已完成專案、建立缺少的索引檔，並更新 ~/.claude/plans/index.yaml。

## 步驟

### 1. 掃描現有索引檔
用 Glob 找出所有 ~/.claude/plans/*.md（排除 archive/ 資料夾），讀取每個檔案解析：
- name：從標題（# xxx）提取
- project_path：專案路徑
- status：狀態（brainstorm、planning、executing、done）
- phase：階段編號
- design_file：設計文件路徑
- plan_file：實作計畫路徑（可選）

記錄所有已被索引的 project_path + design_file 組合，用於步驟 2 的比對。

### 1.5 自動歸檔已完成專案
對於 `status: done` 的索引檔：
1. 確保 `~/.claude/plans/archive/` 目錄存在
2. 將索引檔移動到 `~/.claude/plans/archive/`
3. 記錄歸檔的檔案數量，在最後輸出時回報

### 2. 掃描專案設計文件（自動建立索引）
掃描**當前工作目錄**的 docs/plans/*-design.md，對於沒有對應索引檔的設計文件：

1. 從檔名提取資訊：YYYY-MM-DD-topic-design.md
2. 取得專案名稱：從當前目錄名稱提取並轉小寫（如 Hi-ChatBot → hi-chatbot）
3. 建立索引檔到 ~/.claude/plans/YYYY-MM-DD-project-name-topic.md
4. 索引檔內容：

```
# project-name-topic

project_path: 當前專案路徑
status: planning
design_file: docs/plans/原檔名
```

**判斷是否已有索引檔**：檢查所有現有索引檔的 project_path + design_file 組合是否已指向該設計文件。

### 3. 更新 index.yaml
重新掃描 ~/.claude/plans/*.md（包含新建立的索引檔），用 Write 工具更新 ~/.claude/plans/index.yaml。

## 索引檔格式

```
# Auto-generated by /hi-update-plans-index
# Last updated: YYYY-MM-DD HH:MM

plans:
  - name: yoga-tw
    status: executing
    phase: 2
    path: c:/Users/jimmy.nian/Documents/Claude/yoga-tw
    design_file: docs/plans/2026-01-04-yoga-tw-design.md
    plan_file: docs/plans/2026-01-05-yoga-tw-phase2-content.md
  - name: hi-chatbot-ai-studio
    status: planning
    path: c:/Users/jimmy.nian/Documents/Claude/Hi-ChatBot
    design_file: docs/plans/2026-01-05-ai-studio-collapsible-test-area-design.md
```

## 輸出

完成後回報：
- 掃描到的計畫數量
- 新建立的索引檔數量（如有）
- 自動歸檔的索引檔數量（如有）
- 各狀態的計畫數量（brainstorm / planning / executing）
